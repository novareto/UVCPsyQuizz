[buildout]
extends = code.cfg
parts = uwsgi uwsgi_ini mkdirs deploy_ini app instance zcml daemon


[omelette]
recipe = collective.recipe.omelette
eggs = ${app:eggs}


[settings]
confdir = ${buildout:directory}/conf
session_cache = ${buildout:directory}/session_cache
datadir = ${buildout:directory}/data
cachedir = ${buildout:parts-directory}/cache
logfiles = ${buildout:directory}/var/log
loglevel = INFO
host = 0.0.0.0
port = 9999


[app]
recipe = zc.recipe.egg
eggs = fanstatic
       gevent
       ez_setup
       cromlech.wsgistate
       httplib2
       lxml
       python-gettext
       nva.courses
       Paste
       PasteScript
       PasteDeploy
       z3c.evalexception
       repoze.profile


[mkdirs]
recipe = z3c.recipe.mkdir
paths =
    ${settings:datadir}
    ${settings:confdir}
    ${settings:logfiles}
    ${settings:datadir}/depot
    ${settings:cachedir}/sessions
    ${settings:cachedir}/templates


[zcml]
recipe = collective.recipe.template
input = ${buildout:directory}/etc/main.zcml.in
output = ${settings:confdir}/main.zcml
extra =
    <include package="nva.courses" />


[run]
recipe = z3c.recipe.mkdir
paths = run


[deploy_ini]
recipe = collective.recipe.template
input = ${buildout:directory}/etc/deploy.ini.in
output = ${settings:confdir}/deploy.ini


[uwsgi_ini]
recipe = collective.recipe.template
input = ${buildout:directory}/etc/uwsgi.ini.in
output = ${settings:confdir}/uwsgi.ini


[daemon]
recipe = collective.recipe.template
input = ${buildout:directory}/etc/daemon.sh.in
output = ${buildout:bin-directory}/daemon.sh


[uwsgi]
recipe = zc.recipe.egg
eggs = uwsgi


[instance]
recipe = collective.recipe.scriptgen
cmd = ${buildout:bin-directory}/uwsgi
environment = CHAMELEON_CACHE=${settings:cachedir}
arguments = ${uwsgi_ini:output} --honour-stdin
