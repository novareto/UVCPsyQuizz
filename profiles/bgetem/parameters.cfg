[buildout]
extends = 
    ../common/code.cfg
parts = backup mkdirs deploy_ini app instance zcml omelette supervisor supervisor-reboot
eggs-directory = ${buildout:directory}/eggs
find-links = http://pypi.dolmen-project.org/find-links
	     http://dev.bg-kooperation.de/pypi/simple	     

[omelette]
recipe = collective.recipe.omelette
eggs = ${app:eggs}

[supervisor]
recipe = collective.recipe.supervisor
port = 9002
user =  admin 
password = admin 
serverurl = http://127.0.0.1:9002
supervisord-environment = CHAMELEON_CACHE=${settings:cachedir}/templates,zope_i18n_compile_mo_files=1
programs =
    100 asd ${buildout:directory}/bin/gunicorn [--paste ${buildout:directory}/conf/deploy.ini]

[supervisor-reboot]
recipe = z3c.recipe.usercrontab
times = @reboot
command = ../../bin/supervisord

[backup]
recipe = z3c.recipe.usercrontab
times = 0 8,12,16,20 * * * 
command = ../../backup.sh

[settings]
confdir = ${buildout:directory}/conf
session_cache = ${buildout:directory}/session_cache
datadir = ${buildout:directory}/data
cachedir = ${buildout:directory}/cache
logfiles = ${buildout:directory}/var/log
loglevel = INFO
host = 0.0.0.0
port = 8081
DSN = postgresql+psycopg2://asd:asd@localhost/quizz

[app]
recipe = zc.recipe.egg
eggs = fanstatic
       ez_setup
       httplib2
       lxml
       python-gettext
       nva.psyquizz
       siguvtheme.uvclight
       Paste
       PasteScript
       PasteDeploy
       z3c.evalexception
       repoze.profile
       repoze.vhm
       pdbpp
       gunicorn

[mkdirs]
recipe = z3c.recipe.mkdir
paths =
    ${settings:datadir}
    ${settings:confdir}
    ${settings:logfiles}
    ${settings:datadir}/depot
    ${settings:cachedir}/sessions
    ${settings:cachedir}/templates

[zcml]
recipe = collective.recipe.template
input = ${buildout:directory}/etc/main.zcml.in
output = ${settings:confdir}/main.zcml
extra =
    <include package="nva.psyquizz" />
    <include package="siguvtheme.uvclight" />
    <include package="uvc.protectionwidgets" />
    <browser:recaptcha
       public_key="6LfPuy0UAAAAAH_UUw3VSYua7b3t2ePbLMykIsg7"
       private_key="6LfPuy0UAAAAAGkpOBYPTOv9geViNwViVULYEbVr"
    />

[run]
recipe = z3c.recipe.mkdir
paths = run

[deploy_ini]
recipe = collective.recipe.template
input = ${buildout:directory}/profiles/bgetem/deploy.ini.in
output = ${settings:confdir}/deploy.ini

[instance]
recipe = collective.recipe.scriptgen
cmd = ${buildout:bin-directory}/gunicorn
environment = CHAMELEON_CACHE=${settings:cachedir}/templates zope_i18n_compile_mo_files=1
arguments = --paste ${deploy_ini:output}
